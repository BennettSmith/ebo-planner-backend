openapi: 3.0.3
info:
  title: "East Bay Overland \u2014 Trip Planning API (Draft)"
  version: 0.1.0
  description: 'Draft OpenAPI derived from the **API Notes** sections in the v1 use case specs.


    Guardrails (v1):

    - Members-only system (no unauthenticated users)

    - Planning + RSVP coordination only

    - Capacity measured in rigs (vehicles)

    - Artifacts are externally hosted and referenced by URL'
servers:
- url: https://api.example.com
  description: Production (placeholder)
- url: https://staging-api.example.com
  description: Staging (placeholder)
tags:
- name: Trips
  description: Trip discovery and trip details
- name: Trip Planning
  description: Draft/published trip mutation endpoints
- name: Organizers
  description: Trip organizer management
- name: RSVPs
  description: RSVP coordination endpoints
- name: Members
  description: Member directory and profile endpoints
paths:
  /trips:
    get:
      tags:
      - Trips
      summary: List visible trips for the authenticated member
      operationId: listVisibleTripsForMember
      responses:
        '200':
          description: Visible trips returned
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  trips:
                    type: array
                    items:
                      $ref: '#/components/schemas/TripSummary'
                required:
                - trips
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
      - Trip Planning
      summary: Create a trip draft
      operationId: createTripDraft
      parameters:
      - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTripDraftRequest'
      responses:
        '201':
          description: Draft created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateTripDraftResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}:
    get:
      tags:
      - Trips
      summary: Get trip details (visible to member)
      operationId: getTripDetails
      parameters:
      - $ref: '#/components/parameters/TripId'
      responses:
        '200':
          description: Trip details returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    patch:
      tags:
      - Trip Planning
      summary: Update a trip (draft or published)
      description: 'Organizer-only. For drafts: update draft fields. For published: update published trip fields.'
      operationId: updateTrip
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTripRequest'
      responses:
        '200':
          description: Trip updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/draft-visibility:
    put:
      tags:
      - Trip Planning
      summary: Set draft visibility for a trip draft
      operationId: setTripDraftVisibility
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetDraftVisibilityRequest'
      responses:
        '200':
          description: Draft visibility updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/publish:
    post:
      tags:
      - Trip Planning
      summary: Publish a trip (idempotent)
      operationId: publishTrip
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/IdempotencyKey'
      responses:
        '200':
          description: Trip published (or already published)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/cancel:
    post:
      tags:
      - Trip Planning
      summary: Cancel a trip (idempotent)
      operationId: cancelTrip
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/IdempotencyKey'
      responses:
        '200':
          description: Trip canceled (or already canceled)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/organizers:
    post:
      tags:
      - Organizers
      summary: Add an organizer to a trip
      operationId: addTripOrganizer
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddOrganizerRequest'
      responses:
        '200':
          description: Organizer added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/organizers/{memberId}:
    delete:
      tags:
      - Organizers
      summary: Remove an organizer from a trip
      operationId: removeTripOrganizer
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/MemberId'
      - $ref: '#/components/parameters/IdempotencyKey'
      responses:
        '200':
          description: Organizer removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/rsvp:
    put:
      tags:
      - RSVPs
      summary: Set my RSVP for a published trip
      operationId: setMyRSVP
      parameters:
      - $ref: '#/components/parameters/TripId'
      - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetMyRSVPRequest'
      responses:
        '200':
          description: RSVP updated (idempotent on same value)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SetMyRSVPResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/rsvp/me:
    get:
      tags:
      - RSVPs
      summary: Get my RSVP for a trip
      operationId: getMyRSVPForTrip
      parameters:
      - $ref: '#/components/parameters/TripId'
      responses:
        '200':
          description: My RSVP returned
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  myRsvp:
                    $ref: '#/components/schemas/MyRSVP'
                required:
                - myRsvp
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /trips/{tripId}/rsvps:
    get:
      tags:
      - RSVPs
      summary: Get RSVP summary for a trip
      operationId: getTripRSVPSummary
      parameters:
      - $ref: '#/components/parameters/TripId'
      responses:
        '200':
          description: RSVP summary returned
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  rsvpSummary:
                    $ref: '#/components/schemas/TripRSVPSummary'
                required:
                - rsvpSummary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /members:
    get:
      tags:
      - Members
      summary: List members (minimal directory)
      operationId: listMembers
      responses:
        '200':
          description: Member directory returned
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/MemberSummary'
                required:
                - members
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
      - Members
      summary: Create my member profile (self-provision membership)
      operationId: createMyMember
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMemberRequest'
      responses:
        '201':
          description: Member created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateMemberResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Member already exists for the authenticated subject
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                MemberAlreadyExists:
                  summary: Member already exists
                  value:
                    error:
                      code: MEMBER_ALREADY_EXISTS
                      message: A member profile already exists for the authenticated subject.
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
  /members/search:
    get:
      tags:
      - Members
      summary: Search members by name or email
      operationId: searchMembers
      parameters:
      - $ref: '#/components/parameters/SearchQuery'
      responses:
        '200':
          description: Search results returned
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/MemberSummary'
                required:
                - members
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /members/me:
    patch:
      tags:
      - Members
      summary: Update my member profile
      operationId: updateMyMemberProfile
      parameters:
      - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMyMemberProfileRequest'
      responses:
        '200':
          description: Member profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateMyMemberProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '500':
          $ref: '#/components/responses/InternalError'
    get:
      tags:
      - Members
      summary: Get my member profile (resolved from JWT subject)
      operationId: getMyMemberProfile
      responses:
        '200':
          description: Member profile returned
          content:
            application/json:
              schema:
                type: object
                additionalProperties: false
                properties:
                  member:
                    $ref: '#/components/schemas/MemberProfile'
                required:
                - member
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: No provisioned member exists for the authenticated subject
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                MemberNotProvisioned:
                  summary: Member not provisioned
                  value:
                    error:
                      code: MEMBER_NOT_PROVISIONED
                      message: No member profile exists for the authenticated subject.
        '500':
          $ref: '#/components/responses/InternalError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    TripId:
      name: tripId
      in: path
      required: true
      schema:
        type: string
      description: Trip identifier
    MemberId:
      name: memberId
      in: path
      required: true
      schema:
        type: string
      description: Member identifier
    SearchQuery:
      name: q
      in: query
      required: true
      schema:
        type: string
        minLength: 1
      description: Search query (name or email)
    IdempotencyKey:
      name: Idempotency-Key
      in: header
      required: false
      schema:
        type: string
        minLength: 8
      description: Optional idempotency key for safely retrying mutating requests.
  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    UnprocessableEntity:
      description: Unprocessable Entity
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    TripStatus:
      type: string
      enum:
      - DRAFT
      - PUBLISHED
      - CANCELED
    DraftVisibility:
      type: string
      enum:
      - PRIVATE
      - PUBLIC
    RSVPResponse:
      type: string
      enum:
      - 'YES'
      - 'NO'
      - UNSET
    ArtifactType:
      type: string
      enum:
      - GPX
      - SCHEDULE
      - DOCUMENT
      - OTHER
    Location:
      type: object
      additionalProperties: false
      properties:
        label:
          type: string
        address:
          type: string
          nullable: true
        latitudeLongitude:
          type: object
          nullable: true
          additionalProperties: false
          properties:
            latitude:
              type: number
              format: double
            longitude:
              type: number
              format: double
      required:
      - label
    TripArtifact:
      type: object
      additionalProperties: false
      properties:
        type:
          $ref: '#/components/schemas/ArtifactType'
        title:
          type: string
        url:
          type: string
          format: uri
      required:
      - type
      - title
      - url
    VehicleProfile:
      type: object
      additionalProperties: false
      properties:
        make:
          type: string
          nullable: true
        model:
          type: string
          nullable: true
        tireSize:
          type: string
          nullable: true
        liftLockers:
          type: string
          nullable: true
        fuelRange:
          type: string
          nullable: true
        recoveryGear:
          type: string
          nullable: true
        hamRadioCallSign:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
    MemberSummary:
      type: object
      additionalProperties: false
      properties:
        memberId:
          type: string
        displayName:
          type: string
        email:
          type: string
          format: email
        groupAliasEmail:
          type: string
          format: email
          nullable: true
      required:
      - memberId
      - displayName
      - email
    MemberProfile:
      allOf:
      - $ref: '#/components/schemas/MemberSummary'
      - type: object
        additionalProperties: false
        properties:
          vehicleProfile:
            $ref: '#/components/schemas/VehicleProfile'
            nullable: true
    TripSummary:
      type: object
      additionalProperties: false
      properties:
        tripId:
          type: string
        name:
          type: string
          nullable: true
        startDate:
          type: string
          format: date
          nullable: true
        endDate:
          type: string
          format: date
          nullable: true
        status:
          $ref: '#/components/schemas/TripStatus'
        draftVisibility:
          $ref: '#/components/schemas/DraftVisibility'
          nullable: true
        capacityRigs:
          type: integer
          minimum: 0
          nullable: true
        attendingRigs:
          type: integer
          minimum: 0
          nullable: true
      required:
      - tripId
      - status
    TripDetails:
      type: object
      additionalProperties: false
      properties:
        tripId:
          type: string
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        startDate:
          type: string
          format: date
          nullable: true
        endDate:
          type: string
          format: date
          nullable: true
        status:
          $ref: '#/components/schemas/TripStatus'
        draftVisibility:
          $ref: '#/components/schemas/DraftVisibility'
          nullable: true
        capacityRigs:
          type: integer
          minimum: 0
          nullable: true
        difficultyText:
          type: string
          nullable: true
        meetingLocation:
          $ref: '#/components/schemas/Location'
          nullable: true
        commsRequirementsText:
          type: string
          nullable: true
        recommendedRequirementsText:
          type: string
          nullable: true
        organizers:
          type: array
          items:
            $ref: '#/components/schemas/MemberSummary'
        artifacts:
          type: array
          items:
            $ref: '#/components/schemas/TripArtifact'
        rsvpSummary:
          $ref: '#/components/schemas/TripRSVPSummary'
          nullable: true
        myRsvp:
          $ref: '#/components/schemas/MyRSVP'
          nullable: true
        rsvpActionsEnabled:
          type: boolean
          description: False for drafts and canceled trips.
      required:
      - tripId
      - status
      - organizers
      - artifacts
      - rsvpActionsEnabled
    TripRSVPSummary:
      type: object
      additionalProperties: false
      properties:
        capacityRigs:
          type: integer
          minimum: 0
          nullable: true
        attendingRigs:
          type: integer
          minimum: 0
        attendingMembers:
          type: array
          items:
            $ref: '#/components/schemas/MemberSummary'
        notAttendingMembers:
          type: array
          items:
            $ref: '#/components/schemas/MemberSummary'
      required:
      - attendingRigs
      - attendingMembers
      - notAttendingMembers
    MyRSVP:
      type: object
      additionalProperties: false
      properties:
        tripId:
          type: string
        memberId:
          type: string
        response:
          $ref: '#/components/schemas/RSVPResponse'
        updatedAt:
          type: string
          format: date-time
      required:
      - tripId
      - memberId
      - response
      - updatedAt
    CreateTripDraftRequest:
      type: object
      additionalProperties: false
      description: All fields optional; drafts may be incomplete.
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        startDate:
          type: string
          format: date
          nullable: true
        endDate:
          type: string
          format: date
          nullable: true
        draftVisibility:
          $ref: '#/components/schemas/DraftVisibility'
          nullable: true
        capacityRigs:
          type: integer
          minimum: 0
          nullable: true
        difficultyText:
          type: string
          nullable: true
        meetingLocation:
          $ref: '#/components/schemas/Location'
          nullable: true
        commsRequirementsText:
          type: string
          nullable: true
        recommendedRequirementsText:
          type: string
          nullable: true
        artifacts:
          type: array
          items:
            $ref: '#/components/schemas/TripArtifact'
          nullable: true
    CreateTripDraftResponse:
      type: object
      additionalProperties: false
      properties:
        trip:
          $ref: '#/components/schemas/TripDetails'
      required:
      - trip
    UpdateTripRequest:
      type: object
      additionalProperties: false
      description: Partial update; only provided fields are applied.
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        startDate:
          type: string
          format: date
          nullable: true
        endDate:
          type: string
          format: date
          nullable: true
        draftVisibility:
          $ref: '#/components/schemas/DraftVisibility'
          nullable: true
        capacityRigs:
          type: integer
          minimum: 0
          nullable: true
        difficultyText:
          type: string
          nullable: true
        meetingLocation:
          $ref: '#/components/schemas/Location'
          nullable: true
        commsRequirementsText:
          type: string
          nullable: true
        recommendedRequirementsText:
          type: string
          nullable: true
        artifacts:
          type: array
          items:
            $ref: '#/components/schemas/TripArtifact'
          nullable: true
    TripResponse:
      type: object
      additionalProperties: false
      properties:
        trip:
          $ref: '#/components/schemas/TripDetails'
      required:
      - trip
    SetDraftVisibilityRequest:
      type: object
      additionalProperties: false
      properties:
        draftVisibility:
          $ref: '#/components/schemas/DraftVisibility'
      required:
      - draftVisibility
    AddOrganizerRequest:
      type: object
      additionalProperties: false
      properties:
        memberId:
          type: string
          description: Existing member to add as organizer
      required:
      - memberId
    SetMyRSVPRequest:
      type: object
      additionalProperties: false
      properties:
        response:
          $ref: '#/components/schemas/RSVPResponse'
      required:
      - response
    SetMyRSVPResponse:
      type: object
      additionalProperties: false
      properties:
        myRsvp:
          $ref: '#/components/schemas/MyRSVP'
        rsvpSummary:
          $ref: '#/components/schemas/TripRSVPSummary'
      required:
      - myRsvp
      - rsvpSummary
    UpdateMyMemberProfileRequest:
      type: object
      additionalProperties: false
      description: Partial update; only provided fields are applied.
      properties:
        displayName:
          type: string
          nullable: true
        groupAliasEmail:
          type: string
          format: email
          nullable: true
        vehicleProfile:
          $ref: '#/components/schemas/VehicleProfile'
          nullable: true
    UpdateMyMemberProfileResponse:
      type: object
      additionalProperties: false
      properties:
        member:
          $ref: '#/components/schemas/MemberProfile'
      required:
      - member
    ErrorResponse:
      type: object
      additionalProperties: false
      properties:
        error:
          type: object
          additionalProperties: false
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
              additionalProperties: true
              nullable: true
            requestId:
              type: string
              nullable: true
          required:
          - code
          - message
      required:
      - error
    CreateMemberRequest:
      type: object
      additionalProperties: false
      properties:
        displayName:
          type: string
        email:
          type: string
          format: email
        groupAliasEmail:
          type: string
          format: email
          nullable: true
        vehicleProfile:
          $ref: '#/components/schemas/VehicleProfile'
          nullable: true
      required:
      - displayName
      - email
    CreateMemberResponse:
      type: object
      additionalProperties: false
      properties:
        member:
          $ref: '#/components/schemas/MemberProfile'
      required:
      - member
security:
- bearerAuth: []
